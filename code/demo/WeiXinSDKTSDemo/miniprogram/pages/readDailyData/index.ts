// pages/readDailyData/index.js

import { veepooBle, veepooFeature } from '../../miniprogram_dist/index'
Page({

  /**
   * 页面的初始数据
   */
  data: {
    device: {}
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad(options) {
    let data = {
      status: true
    }
    veepooBle.veepooWeiXinSDKRawDataShowStatus(data)
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady() {
    const HrvData: number[] =
        [88,92,99,98,96,93,83,87,93,97,86,82,96,87,89,95,85,88,88,93,94,93,86,97,89,92,97,108,92,101,89,98,101,98,96,94,96,87,96,83,93,91,83,84,92,79,94,89,80,87,85,77,71,85,78,90,83,98,98,82,80,91,84,101,98,100,93,91,93,102,97,91,96,88,90,93,86,82,95,86,102,95,82,82,91,88,100,95,86,93,93,88,98,90,77,97,86,89,94,90,109,92,87,83,79,84,93,104,120,102,97,92,89,88,83,91,95,92,90,91,90,92,86,89,84,89,90,89,92,102,98,96,95,94,97,94,99,92,98,94,93,93,83,92,94,91,98,108,102,90,107,89,100,93,103,104,101,94,102,97,93,101,91,87,91,89,81,94,91,100,94,83,88,94,96,98,95,81,94,100,99,100,98,94,102,105,94,98,87,85,97,102,104,105,99,104,106,98,96,100,102,101,99,103,107,89,93,101,103,105,97,87,93,104,101,93,102,95,98,92,96,103,100,103,102,104,98,100,98,96,97,109,108,110,106,97,99,95,99,94,95,107,110,108,97,95,100,107,109,98,103,108,100,98,102,108,106,105,109,110,101,102,99,110,107,109,107,104,103,106,100,101,102,105,101,99,96,102,119,106,99,119,114,111,109,105,99,109,113,114,110,100,107,109,107,109,115,116,111,110,101,108,105,107,99,86,95,112,116,105,112,115,112,109,111,104,108,109,107,105,104,110,108,106,99,108,112,102,112,110,107,111,92,112,112,116,112,110,92,104,108,113,108,111,114,117,107,105,111,115,103,111,109,116,112,104,113,112,111,105,109,104,103,107,111,114,110,89,106,102,111,109,111,106,107,109,113,106,97,108,104,112,110,92,108,112,111,108,96,111,109,113,108,110,103,107,110,114,105,113,114,103,109,112,110,88,97,107,111,107,108,102,105,106,109,111,109,110,105,109,110,115,119,115,111,102,108,106,107,112,109,102,95,90,97,110,115,119,109,112,108,112,108,115,117,117,109,105,110,113,112,113,111,113,111,117,114,117,113,112,110,113,110,112,110,111,110,111,112,111,108,112,109,113,111,106,108,109,108,110,111,109,112,110,117,112,110,109,106,112,111,110,111,109,107,108,109,108,111,114,109,110,113,114,106,98,107,106,110,111,110,111,108,110,112,111,112,111,107,111,112,108,112,108,110,105,110,114,109,112,109,112,111,110,111,113,104,105,112,110,114,110,104,109,111,110,115,113,112,110,109,106,112,110,111,108,110,105,107,110,116,114,109,106,110,112,107,111,114,116,112,118,108,110,109,110,113,111,115,114,112,111,113,110,113,110,110,106,110,109,115,106,110,111,110,114,110,108,106,109,115,112,110,111,113,93,105,115,113,114,113,112,109,111,114,109,111,108,112,108,115,112,114,109,86,98,104,103,114,107,95,100,109,103,109,106,104,107,109,105,101,110,107,111,116,109,106,97,108,112,113,107,109,101,105,101,109,103,102,103,107,111,109,111,108,112,109,111,109,106,109,110,107,109,107,108,104,105,107,106,112,110,107,109,110,107,111,109,108,107,108,109,111,107,110,111,109,112,108,106,108,107,107,108,103,90,102,112,109,108,102,106,110,109,114,108,111,107,109,107,111,112,111,109,110,105,110,106,109,111,109,112,118,108,109,112,107,110,108,109,108,111,109,108,103,108,109,109,112,110,108,111,107,109,111,110,112,108,109,114,115,114,109,93,111,107,109,113,110,114,108,111,112,108,110,113,110,106,108,112,111,115,118,113,110,106,107,111,109,107,113,105,111,108,110,104,99,110,109,106,108,110,112,110,114,96,109,117,112,108,103,111,108,111,109,110,102,108,106,108,110,108,107,106,110,109,110,105,109,107,105,109,112,106,109,108,111,112,110,105,109,112,108,107,109,105,107,111,115,112,109,111,116,113,111,109,105,103,109,111,112,110,106,108,114,112,111,112,108,112,102,104,110,106,108,113,111,112,108,107,104,107,110,111,110,111,108,112,116,111,108,106,110,98,112,110,104,110,108,93,96,84,84,102,109,87,97,105,108,107,109,99,89,94,112,109,108,110,111,114,119,108,113,99,103,98,102,105,112,118,115,98,90,93,99,101,100,103,112,115,112,108,99,103,102,99,97,88,90,93,98,109,111,109,93,89,91,95,92,88,111,108,106,116,119,112,103,96,91,94,92,97,88,111,118,116,112,101,96,90,85,89,94,89,91,93,89,104,111,90,103,104,110,109,112,108,105,94,102,96,88,100,111,103,101,94,89,99,94,99,103,102,99,102,110,119,113,112,108,94,97,111,97,84,91,103,116,121,116,107,95,85,79,93,100,103,112,106,98,124,129,124,104,89,93,101,91,89,90,83,89,93,96,100,108,107,102,97,90,94,85,82,92,88,93,91,80,81,93,104,107,110,107,103,100,98,104,102,104,103,98,94,100,96,92,103,98,97,99,96,93,92,93,99,103,109,117,110,108,101,79,96,103,99,100,97,102,97,103,101,108,115,118,113,112,114,111,109,105,113,108,107,99,98,82,99,97,103,102,93,97,93,97,96,97,100,110,112,115,107,111,107,100,91,101,93,91,88,106,98,78,96,91,98,95,104,111,101,84,101,95,81,86,92,95,93,92,96,96,95,98,92,95,83,101,93,89,97,103,101,100,109,107,101,97,101,99,98,101,98,101,98,101,102,107,100,96,94,89,89,107,104,95,93,100,91,94,98,102,99,97,99,95,88,98,100,109,102,100,101,99,103,97,94,95,96,92,104,101,98,102,100,104,100,102,96,89,91,89,110,102,105,101,104,105,100,95,93,94,99,107,102,99,97,93,99,94,97,102,101,96,86,81,97,100,111,106,102,103,101,100,98,104,106,104,105,104,102,100,102,105,98,101,104,103,102,100,104,101,105,102,108,102,98,100,105,109,106,108,105,105,103,101,97,101,78,99,108,103,99,106,103,99,107,107,110,102,104,107,108,106,101,107,109,105,103,98,106,107,105,108,105,104,102,105,106,107,105,105,107,101,97,99,107,103,104,111,108,107,103,106,101,98,109,104,110,104,107,104,110,104,101,96,106,100,97,103,107,112,109,105,101,105,102,102,104,105,103,105,102,107,104,105,104,98,105,103,104,102,104,103,106,103,105,101,107,106,107,109,115,92,109,106,102,98,79,92,103,101,105,107,99,102,109,107,104,106,109,102,104,102,98,103,107,102,100,106,101,102,105,100,107,101,106,114,107,95,87,103,108,110,106,104,109,100,94,95,86,81,90,93,108,106,107,102,105,104,99,96,94,95,100,104,105,104,107,103,98,100,99,103,94,110,108,111,105,107,99,107,101,107,102,109,107,102,104,103,106,108,98,97,103,101,102,83,103,108,110,108,110,106,107,106,97,101,85,90,107,106,107,106,103,108,104,111,99,104,100,102,106,94,112,103,106,103,104,103,105,102,107,99,104,105,106,105,106,105,103,101,99,102,107,106,102,106,104,108,104,101,104,106,100,103,107,103,108,104,107,104,106,82,95,107,110,103,104,105,102,105,106,101,107,101,96,104,105,108,107,102,103,106,103,109,103,106,101,104,108,101,103,102,100,108,103,105,104,96,106,100,104,104,107,104,103,91,92,100,106,89,90,89,84,94,83,99,92,97,90,97,96,91,92,96,91,108,103,102,101,103,106,103,97,99,97,102,96,101,100,103,102,105,97,94,101,102,91,99,114,102,90,104,110,104,100,101,100,94,95,94,95,83,89,80,85,105,111,110,104,101,96,95,106,102,97,94,90,94,87,78,93,111,108,107,103,104,94,92,85,111,122,118,109,111,107,108,106,101,103,106,102,109,107,110,108,106,94,105,111,112,116,112,122,121,120,100,92,96,94,97,88,93,111,107,106,100,95,84,86,92,82,81,101,103,101,100,101,99,102,97,116,123,122,126,122,123,113,116,115,109,114,108,103,104,101,109,91,99,97,91,95,104,86,100,104,102,93,107,115,112,100,85,96,83,92,84,89,83,100,106,102,108,109,110,118,119,114,115,99,89,92,95,97,106,116,115,116,107,97,84,95,102,103,108,117,118,86,103,115,112,113,103,92,93,92,97,98,96,87,92,93,90,111,116,113,110,113,110,115,104,108,100,95,96,87,86,93,107,102,107,110,107,113,107,109,107,106,107,106,108,106,103,111,116,118,115,111,95,107,116,119,118,106,95,99,108,113,111,110,91,100,117,120,119,118,105,108,103,102,108,112,110,106,102,112,110,111,108,114,110,104,106,109,116,114,103,102,97,101,107,113,108,107,114,123,125,95,90,124,117,111,108,107,99,97,96,84,82,86,103,119,115,120,121,117,115,113,108,96,102,117,121,106,103,110,112,98,93,100,99,108,100,103,100,106,112,109,101,111,119,115,107,111,105,97,102,112,108,109,104,107,101,100,107,111,110,101,92,93,109,110,114,115,110,108,112,112,92,110,105,112,103,108,102,105,101,102,106,113,110,111,118,105,109,110,108,113,115,113,107,112,87,108,109,110,108,85,104,101,95,93,86,93,100,110,99,101,92,102,101,96,86,105,93,103,100,79,100,87,97,105,84,87,93,89,102,95,85,99,93,102,99,93,83,99,91,93,97,90,82,96,86,91,95,84,85,93,97,96,94,82,93,96,82,95,91,82,101,89,84,96,88,90,96,86,80,94,87,93,94,82,87,92,82,101,90,81,89,90,83,99,89,79,90,94,85,98,83,77,92,90,86,98,81,80,79,86,99,93,79,89,88,93,98,88,82,98,87,95,96,85,80,92,80,101,94,80,97,91,84,96,85,88,78,84,88,94,90,84,96,93,83,85,96,84,81,77,94,97,85,71,88,80,87,94,82,99,87,80,74,67,86,81,82,70,77,78,82,84,81,76,93,85,80,74,81,92,97,99,95,80,76,85,68,70,84,79,80,83,86,85,86,77,90,87,81,80,73,77,81,82,82,89,91,85,92,86,91,78,74,83,90,82,81,81,85,83,95,92,96,77,82,89,85,81,78,82,77,82,84,80,89,96,85,96,95,83,80,73,90,94,80,77,84,81,80,90,93,95,90,83,78,75,91,84,86,85,74,73,77,90,91,99,97,95,85,82,80,89,94,89,95,91,95,88,84,81,83,87,88,82,81,86,82,90,84,92,97,86,83,89,87,89,80,80,83,87,91,82,84,89,89,93,103,86,94,88,87,95,89,84,82,89,91,98,96,81,77,90,84,96,92,87,86,77,73,79,84,88,97,94,85,84,85,78,93,95,85,92,87,88,90,86,85,80,81,83,79,81,84,87,90,88,78,94,86,84,85,93,83,87,82,86,84,77,84,80,83,98,91,79,80,77,84,86,88,87,77,79,89,80,77,79,86,88,96,98,86,77,79,80,93,98,100,93,85,95,98,82,87,95,86,95,89,83,97,93,84,82,91,88,86,84,87,77,85,91,96,92,85,83,80,95,83,86,93,83,80,97,86,80,87,90,89,99,95,96,92,90,89,95,92,86,97,95,82,83,74,81,94,91,87,83,85,79,77,81,84,85,78,79,77,71,92,91,94,99,88,96,98,86,77,94,86,82,83,79,82,75,80,85,82,84,82,84,82,80,83,97,99,93,80,86,88,92,82,70,76,76,79,78,99,81,83,86,78,98,83,78,83,96,98,83,75,96,93,77,96,92,83,94,84,76,70,76,74,75,89,84,79,84,86,88,85,89,96,98,100,97,83,77,71,57,74,80,76,90,81,87,86,97,99,98,84,91,85,83,81,92,85,80,75,82,71,93,95,98,92,96,100,80,82,80,98,92,90,73,76,80,74,78,92,83,89,85,91,95,80,95,98,101,97,95,84,85,78,76,92,76,83,82,97,85,87,85,84,93,89,81,84,99,93,83,96,97,79,85,84,91,85,79,74,77,67,86,94,99,93,98,94,88,81,92,79,86,88,78,66,72,76,72,84,88,76,90,86,83,65,75,83,93,94,84,85,96,84,88,83,91,83,79,77,82,78,87,91,96,102,85,96,90,79,82,93,85,86,80,79,76,82,80,87,98,100,99,95,87,77,80,79,95,79,81,82,72,67,77,80,95,88,92,97,89,91,82,77,79,92,85,97,93,82,80,78,80,83,96,96,83,91,94,86,77,76,79,87,82,77,87,98,93,75,85,91,99,98,88,82,78,93,83,85,72,79,73,82,78,80,75,87,98,97,81,84,78,84,81,80,81,75,77,59,65,58,69,97,99,95,82,80,86,87,85,87,97,93,81,91,84,92,87,83,79,85,92,89,95,77,83,97,101,81,82,90,85,95,97,81,74,76,79,98,81,78,84,97,81,87,92,84,96,85,82,85,77,82,91,98,87,92,82,88,90,83,81,75,88,95,91,86,93,82,80,78,93,81,90,85,98,91,81,79,81,68,77,71,79,82,83,82,95,98,87,81,87,93,75,82,91,78,75,72,76,73,79,76,84,95,98,99,93,79,81,81,98,102,98,84,76,95,85,90,79,80,78,78,84,81,79,92,99,88,75,95,95,81,84,93,98,81,75,92,73,78,83,82,85,78,85,78,85,91,94,98,85,81,79,80,81,90,98,89,78,81,84,87,79,70,76,78,70,77,81,79,94,98,104,85,89,85,80,81,96,92,84,85,80,79,89,79,89,90,83,94,93,81,83,89,79,80,92,90,76,70,79,74,78,92,98,95,91,84,82,86,82,77,83,86,89,87,81,76,73,70,76,80,85,99,95,98,99,86,82,87,91,97,99,98,96,83,87,76,87,82,85,78,92,79,84,78,84,88,73,79,81,85,97,94,92,98,89,82,76,70,66,74,69,82,85,83,87,92,91,92,99,100,99,87,82,78,87,78,84,78,56,65,75,78,80,96,81,77,77,79,78,97,78,98,93,95,96,83,78,86,84,85,87,81,85,87,95,98,95,88,87,84,78,82,87,91,83,80,83,80,79,87,94,85,90,92,88,96,77,84,83,93,85,83,82,81,73,98,78,91,92,91,93,86,84,80,81,80,95,90,82,85,86,73,82,98,100,89,71,74,81,76,82,77,75,83,84,80,81,82,87,94,92,87,96,85,82,77,87,89,87,80,77,79,82,94,98,101,99,101,88,76,80,81,77,79,85,79,73,77,72,80,83,88,90,99,86,81,83,90,96,100,88,87,98,96,80,75,80,83,69,86,72,87,83,88,93,86,82,83,82,80,82,81,82,78,76,86,90,101,94,98,89,86,72,82,88,97,99,100,98,102,78,83,90,98,93,78,84,73,79,82,74,76,89,97,91,81,79,81,77,88,91,98,93,87,99,89,81,78,84,73,85,84,83,93,94,84,83,99,100,99,94,94,97,85,84,81,79,81,72,80,76,84,98,97,98,89,79,81,81,79,96,84,79,78,78,74,81,85,99,103,85,83,88,81,80,89,100,93,92,93,85,86,88,79,75,82,87,82,74,79,89,92,82,74,79,80,83,90,84,95,85,82,80,76,83,80,75,78,73,76,73,67,75,93,91,95,87,70,83,81,82,78,95,99,90,85,80,79,80,76,69,75,82,85,84,81,98,88,89,98,93,90,83,80,78,84,95,99,85,82,80,76,87,99,102,87,82,84,78,76,82,80,88,99,101,76,83,81,80,88,82,77,84,94,95,74,82,87,98,99,98,87,93,87,84,81,90,99,85,83,81,94,82,81,88,82,91,87,85,97,84,79,84,83,81,82,69,73,80,77,56,74,97,100,99,89,75,80,83,85,83,97,92,85,81,75,77,76,77,83,94,99,98,83,85,86,88,99,106,98,91,94,87,74,71,82,73,75,75,82,84,78,83,96,99,95,78,76,80,77,94,93,82,80,73,65,68,89,92,93,88,84,78,74,71,83,80,84,87,73,79,74,70,76,81,81,78,76,78,79,83,96,78,84,98,91,73,82,83,90,93,86,97,99,85,87,90,82,81,72,74,75,87,97,94,96,91,97,87,98,83,90,86,95,89,78,72,77,69,77,78,88,85,88,85,81,88,77,83,93,99,78,89,86,85,86,93,71,76,79,66,72,70,91,96,99,95,97,89,90,81,82,84,91,94,72,63,55,60,74,79,86,100,97,86,81,77,80,82,98,97,103,96,99,83,97,87,84,94,100,87,94,81,78,82,90,88,95,97,80,88,94,82,84,90,70,64,77,72,60,79,94,98,96,90,89,72,82,87,91,98,99,91,82,67,77,66,76,74,85,87,84,88,78,89,95,93,98,95,93,89,81,87,85,83,80,98,82,94,97,85,76,81,97,95,92,77,76,82,87,79,86,83,82,85,84,80,82,94,97,100,95,96,88,85,95,96,255,255,255,255,255,255,255,255,255,88,93,108,96,88,90,85,84,85,89,85,82,77,72,70,74,91,96,86,82,84,87,81,78,73,94,87,99,96,83,80,71,73,82,96,88,94,85,84,88,91,100,106,98,99,87,84,83,87,85,80,96,101,96,93,84,88,93,96,87,85,79,89,82,79,82,91,88,78,64,70,68,80,77,88,93,95,101,88,92,78,90,99,97,82,77,82,74,75,68,83,84,98,90,88,82,83,89,93,86,88,96,100,97,82,79,95,83,79,85,80,76,83,79,85,87,85,99,106,83,80,83,80,88,91,96,80,73,69,76,85,99,98,95,85,84,85,80,82,78,94,87,82,84,83,78,84,74,76,77,84,75,83,86,100,83,87,96,85,98,94,93,75,81,97,87,93,90,82,89,84,83,74,81,74,82,83,82,85,78,95,90,81,78,88,81,73,88,86,78,75,78,75,68,80,95,85,96,84,79,82,80,79,100,83,92,98,96,92,71,78,74,79,77,81,87,79,82,78,84,95,97,96,78,86,91,95,97,78,75,68,70,79,93,98,94,97,80,79,81,86,91,93,86,77,74,80,83,82,80,86,71,73,75,94,77,78,81,80,79,78,86,87,98,91,93,87,88,79,84,66,80,83,70,76,75,87,94,95,89,80,77,76,83,80,93,97,84,86,93,83,85,84,86,82,77,93,88,83,80,84,85,78,100,98,112,87,89,82,80,79,82,73,72,79,81,77,80,96,99,93,88,98,85,84,95,93,87,73,65,71,70,84,79,85,99,103,100,97,84,78,97,98,100,95,84,85,82,73,78,84,93,81,84,81,96,76,83,85,88,94,98,85,87,75,82,81,89,96,74,64,69,75,78,77,82,87,86,95,92,82,80,82,80,83,89,88,70,72,68,75,65,75,89,98,99,90,88,72,76,75,91,88,84,88,81,78,77,63,81,89,82,95,90,78,73,81,80,81,85,90,82,84,87,73,81,79,88,76,88,90,83,81,75,78,88,91,98,94,85,82,80,85,79,82,77,80,74,68];

    let list: number[] = [];
    HrvData.forEach((item) => {
      list.push(item / 10)
    })

    let drawArr = veepooFeature.veepooGetLorentzScatterPlotData(HrvData);
    console.log("洛伦兹散点图==>", drawArr)
    let starIndexs = veepooFeature.veepooGetLorentzScatterPlotStarIndex(HrvData);
    console.log("洛伦兹星级starIndexs==>", starIndexs);
    console.log("arr=>", HrvData)
    let similarity = veepooFeature.VeepooGetLorentzScatterPlotSimilarity(HrvData);
    console.log("洛伦兹相似度similarity=>", similarity)
  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow() {
    this.notifyMonitorValueChange();
  },
  readData(e: any) {
    let index = e.currentTarget.dataset.index
    let data = {
      day: index, // 0 今天  1 昨天 2 前天
      package: 1
    }
    veepooFeature.veepooSendReadDailyDataManager(data);
  },
  notifyMonitorValueChange() {
    let self = this;
    veepooBle.veepooWeiXinSDKNotifyMonitorValueChange(function (e: any) {
      console.log("日常数据 监听蓝牙回调=>", e);
      // 睡眠数据
      if (e && e.type == 5) {
        self.setData({
          device: e
        })
        console.log("日常数据====》", e.content.reverse())
        if (e && e.type == 5 && e.Progress == 100) {
          let content = e.content.reverse();
          let arr: any = []
          let rr50Array: number[] = [];
          content.forEach((item: any) => {
            let obj = item.bloodPressure
            let date = item.date.split("-");
            // 获取7小时rr50值
            if (Number(date[3]) < 7) {
              // console.log("item.rr50=>", item.rr50)
              rr50Array.push(...item.rr50)
            }
            arr.push(obj)
          });
          console.log('rr50Array==>', rr50Array);
          console.log('rr50Array.length==>', rr50Array.length);

          let drawArr = veepooFeature.veepooGetLorentzScatterPlotData(rr50Array);
          console.log("洛伦兹散点图==>", drawArr)
          let starIndexs = veepooFeature.veepooGetLorentzScatterPlotStarIndex(rr50Array);
          console.log("洛伦兹星级starIndexs==>", starIndexs);
          console.log("arr=>", arr)
          let similarity = veepooFeature.VeepooGetLorentzScatterPlotSimilarity(rr50Array);
          console.log("洛伦兹相似度similarity=>", similarity)
        }
      }
    })
  },
})